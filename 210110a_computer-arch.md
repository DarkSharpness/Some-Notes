# 有关于计算机体系结构知识的笔记，备忘

主要是《大话处理器》以及国外经典教材《深入理解计算机系统》《计算机体系结构量化研究方法》的阅读笔记，记录有关于Computer Architecture的方方面面

重点在于各种架构处理器内核、ISA、内存结构的设计思想，以及特性

## 1 《大话处理器》处理器基础知识

对于处理器有个基本的概念

### 1.1 什么是通用处理器

现代计算机的中央处理器根本都是属于冯诺伊曼结构，后来基于冯诺伊曼结构改进而来的**哈佛结构分离了取指总线和数据总线**。冯诺伊曼在第一台二进制电子计算机EDVAC的草案中，明确指出计算机应该由**运算器，存储器，逻辑控制部分，输入输出**部件组成。

理论上几乎所有运算逻辑都可以用硬件实现，现代通用处理器正是使用**通用寄存器-算术单元-控制逻辑**的设计实现了通用运算

### 1.2 处理器和ISA

**ISA**即**Instruction Set Architecture**，指令集架构，可以理解为遵循某指令集体系结构的标准，而**微架构Microarchitecture**可以理解为遵循某种ISA标准设计而来的处理器的实例。

比如，Intel和AMD公司持有x86指令集，他们可以设计制造遵循x86体系结构的处理器。Intel有面向高性能的酷睿（Core）以及低功耗的凌动（Atom），这两个产品线使用的是不同的微架构。现在所有智能手机使用的都是基于ARM指令集的处理器，手机为了均衡功耗通常都会集成几个高性能核心和几个低功耗核心，比如Cortex-A76和Cortex-A55就是遵循相同指令集架构（ARMv8A）而使用不同微架构的实例。

一般处理器ISA可以分为两类，**一类是CISC，一类是RISC**

使用**CISC**设计思想的处理器一般出现较早，**有相对较少的通用寄存器，较多的寻址方式，基本指令也较多，一个指令一般由多个周期完成**，目前基本只有x86存活，其他已十分少见。

使用**RISC**设计思想的处理器之后才出现，**有较多的通用寄存器，非常简单的寻址方式（一般基于Load-Store），基本指令较少（现在也不少了，尤其是加上SIMD等扩展指令，~~可以看看ARM文档有多少页qwq~~），一个指令一般由单个或少数几个周期完成，适用于流水化**，目前百花齐放，有ARM，MIPS，IBM的PowerPC，DEC的Alpha，Sun（被Oracle收购）的SPARC，Microchip的AVR，Cadence的xtensa，以及近几年很火的RISC-V等。

**指令集和处理器性能表现是不相关的两方面**。以前经常有人拿使用ARM指令集的手机处理器和使用x86指令集的电脑处理器对比，**认为ARM只适用于低功耗场合，x86只适用于高性能场合，说ARM指令集不如x86指令集，不能用于高性能，RISC不如CISC之类云云。这是错误的认识**。如今苹果已经计划将ARM带入到高性能工作站，而Intel无法进入移动领域，除了本身市场定位和策略促成，**也正是因为x86最初基于CISC的设计导致x86较难适应RISC的潮流**，Intel处理器需要使用比其他RISC指令处理器多得多的晶体管，以将指令在内部RISC化，并且保证30多年来的指令兼容，大大增加了高效处理器的设计难度。**其实RISC是在编译技术发展之后兴起的更加符合时代，更加便于未来提高处理器性能的设计思想，而CISC产生当时很多程序都要使用汇编编写**。事实上Intel每次开发新的微架构时大部分资金投入于对于旧指令集的兼容。**设计一种ISA很容易，但是市场和软件生态才能决定一种ISA是否可以存活**。Intel赢在了不惜代价维护现有生态。而RISC领域教科书级别的MIPS，最终输在了生态上，如今只在路由器常见。

### 1.3 处理器指令与数据存放

一般处理器的汇编代码由操作码和操作数构成，如下为RISC中常见的加法指令

```
ADD R0, R1, R2 # 将寄存器R1和R2数值相加存到R0中，ADD为操作码，R0为目的操作数，R1和R2为源操作数
```

一般处理器数据存放有**Big-Endian**和**Little-Endian**模式。**由于计算机处理数据的最小粒度为1Byte(8bit)**，在内存中存放一个32bit的数据也是有顺序的

**Little-Endian**就是将数据最低一字节存放在内存较小地址处，**Big-Endian**则相反。x86使用**Little-Endian**，而ARM可以调节大小端模式。

### 1.4 处理器微架构

#### 1.4.1 处理器流水线



## 2 《计算机体系结构量化研究方法》计算机架构进阶