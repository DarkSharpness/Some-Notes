# USB：硬件，通信协议与驱动，应用开发

## 1 导论

USB已经成为当今使用最广泛的计算机外设接口之一

当前最常用的是USB3.0，并且向下兼容USB2.0以及USB1.1。USB3.0理论最大可以支持5Gbit/s的传输速率（超高速模式），而USB2.0支持480Mbit/s（高速模式），12Mbit/s（全速模式）以及1.5Mbit/s（低速模式）三种传输速率，其中全速模式以及低速模式是原USB1.0规范定义的

USB有一个特性就是支持自动的驱动配置以及加载，可以做到即插即用，同时支持热插拔。相比其他总线接口，USB还提供了电源，使得这些设备无需单独的电源。同时USB没有对其信号线功能做具体的定义

另外，USB还具有较好的实时性能，可以将数据的传输以及最后的计算机处理过程的延迟降到很低


## 2 硬件接口与电气规范


## 3 数据传输


## 4 描述符


## 5 SETUP包与标准设备请求


## 6 枚举


## 7 补充：设备树

开发Linux硬件驱动必备知识

参考文档可以在[devicetree.org](https://www.devicetree.org/)下载

**设备树**是在ARM等没有BIOS和ACPI的平台中常用的设备描述文件，操作系统内核需要设备树文件来管理CPU，内存，外设等硬件

Bootloader可以在加载操作系统时将存储的静态设备树传递过去，也可以自动生成设备树，如UBoot。如果Bootloader不支持上述特性，那么设备树也可以安装在操作系统中

## 7.1 设备树文件格式

设备树顾名思义，其数据结构为树状结构，其中每一个元素称为树中的一个**节点**（node），每一个节点会包含**属性**（properties）和**子节点**（child nodes），每一个属性都是**键值对**（name-value pairs）

设备树有两种存在形式，一种是二进制形式，被操作系统使用；一种是文本形式，便于人工编辑

文本形式的设备树源文件后缀`.dts`，需要通过**设备树编译器**`dtc`编译为`.dtb`二进制格式。和C一样，设备树也可以使用`#include`包含其他设备树文件